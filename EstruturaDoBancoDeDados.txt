--Criar Tabela Alunos
CREATE TABLE ALUNOS (
	ID INTEGER NOT NULL,
	NOME VARCHAR(100) NOT NULL,
	CPF VARCHAR(14) NOT NULL,
	CONSTRAINT "ALUNOS_PK                      " PRIMARY KEY (NOME,CPF),
	CONSTRAINT "ALUNOS_UN                      " UNIQUE (ID)
);
CREATE UNIQUE INDEX ALUNOS_PK ON ALUNOS (NOME,CPF);
CREATE UNIQUE INDEX ALUNOS_UN ON ALUNOS (ID);

--Criar sequence.
CREATE SEQUENCE ALUNOS_SEQ

--Criar trigger
CREATE TRIGGER ALUNOS_TR FOR ALUNOS BEFORE INSERT
AS
BEGIN
        IF (NEW.ID IS NULL) THEN
        NEW.ID =  GEN_ID(ALUNOS_SEQ, 1);
END

-- Fim Tabela Alunos

--Criar Tabela Professores
CREATE TABLE PROFESSORES (
	ID INTEGER NOT NULL,
	NOME VARCHAR(100) NOT NULL,
	CPF VARCHAR(14) NOT NULL,
	CONSTRAINT "PROFESSORES_PK                 " PRIMARY KEY (NOME,CPF),
	CONSTRAINT "PROFESSORES_UN                 " UNIQUE (ID)
);
CREATE UNIQUE INDEX PROFESSORES_PK ON PROFESSORES (NOME,CPF);
CREATE UNIQUE INDEX PROFESSORES_UN ON PROFESSORES (ID);

--Criar sequence.
CREATE SEQUENCE PROFESSORES_SEQ

--Criar trigger
CREATE TRIGGER PROFESSORES_TR FOR PROFESSORES BEFORE INSERT
AS
BEGIN
        IF (NEW.ID IS NULL) THEN
        NEW.ID =  GEN_ID(PROFESSORES_SEQ, 1);
END

--Fim Tabela Professores

--Criar Tabela Disciplina
CREATE TABLE DISCIPLINAS (
	ID INTEGER NOT NULL,
	DISCIPLINA VARCHAR(100) NOT NULL,
	CONSTRAINT "DISCIPLINAS_PK                 " PRIMARY KEY (DISCIPLINA),
	CONSTRAINT "DISCIPLINAS_UN                 " UNIQUE (ID)
);
CREATE UNIQUE INDEX DISCIPLINAS_PK ON DISCIPLINAS (DISCIPLINA);
CREATE UNIQUE INDEX DISCIPLINAS_UN ON DISCIPLINAS (ID);

--Criar sequence.
CREATE SEQUENCE DISCIPLINAS_SEQ

--Criar trigger
CREATE TRIGGER DISCIPLINAS_TR FOR DISCIPLINAS BEFORE INSERT
AS
BEGIN
        IF (NEW.ID IS NULL) THEN
        NEW.ID =  GEN_ID(DISCIPLINAS_SEQ, 1);
END
--Fim Tabela Disciplina

--Criar Tabela DISCIPLINAS_PROFESSORES
CREATE TABLE DISCIPLINAS_PROFESSORES (
	DISCIPLINA_ID INTEGER NOT NULL,
	PROFESSOR_ID INTEGER NOT NULL,
	CONSTRAINT "DISCIPLINAS_PROFESSOR_PK       " PRIMARY KEY (DISCIPLINA_ID,PROFESSOR_ID)
);
CREATE UNIQUE INDEX DISCIPLINAS_PROFESSORES_PK ON DISCIPLINAS_PROFESSORES (DISCIPLINA_ID,PROFESSOR_ID);
CREATE UNIQUE INDEX DISCIPLINAS_PROFESSOR_PK ON DISCIPLINAS_PROFESSORES (DISCIPLINA_ID,PROFESSOR_ID);
CREATE INDEX DISCIPLINA_FK ON DISCIPLINAS_PROFESSORES (DISCIPLINA_ID);
CREATE INDEX PROFESSOR_FK ON DISCIPLINAS_PROFESSORES (PROFESSOR_ID);

ALTER TABLE DISCIPLINAS_PROFESSORES ADD CONSTRAINT DISCIPLINA_FK FOREIGN KEY (DISCIPLINA_ID) REFERENCES DISCIPLINAS(ID);
ALTER TABLE DISCIPLINAS_PROFESSORES ADD CONSTRAINT PROFESSOR_FK FOREIGN KEY (PROFESSOR_ID) REFERENCES PROFESSORES(ID);

--Fim Tabela DISCIPLINAS_PROFESSORES

--Criar Tabela NOTAS
CREATE TABLE NOTAS (
	ID INTEGER NOT NULL,
	DISCIPLINA_ID INTEGER NOT NULL,
	ALUNO_ID INTEGER NOT NULL,
	PROFESSOR_ID INTEGER NOT NULL,
	NOTA_PERIODO_1 FLOAT,
	NOTA_PERIODO_2 FLOAT,
	NOTA_TRABLHO FLOAT,
	MEDIA FLOAT,
	SITUACAO VARCHAR(100),
	CONSTRAINT "NOTAS_PK                       " PRIMARY KEY (DISCIPLINA_ID,ALUNO_ID,PROFESSOR_ID)
);
CREATE UNIQUE INDEX NOTAS_PK ON NOTAS (DISCIPLINA_ID,ALUNO_ID,PROFESSOR_ID);
CREATE INDEX NOTA_ALUNO_FK ON NOTAS (ALUNO_ID);
CREATE UNIQUE INDEX NOTA_PK ON NOTAS (DISCIPLINA_ID,ALUNO_ID,PROFESSOR_ID);
CREATE INDEX NOTA_PROFESSOR_DISCIPLINA_FK ON NOTAS (DISCIPLINA_ID,PROFESSOR_ID);

ALTER TABLE NOTAS ADD CONSTRAINT NOTA_ALUNO_FK FOREIGN KEY (ALUNO_ID) REFERENCES ALUNOS(ID);
ALTER TABLE NOTAS ADD CONSTRAINT NOTA_PROFESSOR_DISCIPLINA_FK FOREIGN KEY (DISCIPLINA_ID,PROFESSOR_ID) REFERENCES DISCIPLINAS_PROFESSORES(DISCIPLINA_ID,PROFESSOR_ID);

--Criar sequence.
CREATE SEQUENCE NOTAS_SEQ

--Criar trigger
CREATE TRIGGER NOTAS_TR FOR NOTAS BEFORE INSERT
AS
BEGIN
        IF (NEW.ID IS NULL) THEN
        NEW.ID =  GEN_ID(NOTAS_SEQ, 1);
END

--Fim Tabela NOTAS